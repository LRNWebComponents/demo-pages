<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../app-route/app-route.html">
<link rel="import" href="../app-route/app-location.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-demo-helpers/demo-pages-shared-styles.html">
<link rel="import" href="../iron-demo-helpers/demo-snippet.html">

<!--
`demo-pages`
A LRN element

@demo demo/index.html
-->

<dom-module id="demo-pages">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <app-location route="{{__route}}"></app-location>
    <app-route
      id="route"
      route="{{__route}}"
      pattern=":page"
    >
    </app-route>

    
    <template is="dom-if" if="[[navigation]]">
      <template is="dom-repeat" items="[[__navigation]]">
        <paper-button data-index$="[[index]]" on-click="__updateActiveSection">[[item]]</paper-button>
      </template>
    </template>

    <iron-pages selected="{{selected}}">
      <slot id="slot"></slot>
    </iron-pages>
    
  </template>

  <script>
    Polymer({

      is: 'demo-pages',

      properties: {
        /**
         * Should there be navigation
         */
        navigation: {
          type: Boolean,
          value: false,
        },
        /**
         * The currently selected item
         */
        selected: {
          type: String,
          value: 0,
          notify: true,
        },
        __route: {
          type: Object,
        },
        __navigation: {
          type: Array,
          value: []
        },
      },

      observers: [
        '__routeChanged(__route)'
      ],

      ready: function () {
        const allChildren = Polymer.dom(this.$.slot).getDistributedNodes();
        // get all children
        const children = allChildren.filter((i) => i.nodeName === 'SECTION');
        // convert to navigation
        const navigation = children.map(i => i.getAttribute('title') || i.innerText);
        console.log(navigation)
        // if there ar nav elements
        if (navigation) {
          this.set('__navigation', []);
          this.set('__navigation', navigation);
        }
      },

      /**
       * Trigger selected state change
       */
      updateSelected: function (selected) {
        this.$.route.queryParams = {
          demo: selected
        }
      },

      /**
       * When a user clicks the section button update
       * the url.  The url will then trigger the state
       * change.
       */
      __updateActiveSection: function (e) {
        const index = e.target.getAttribute('data-index');
        this.updateSelected(index);
      },

      /**
       * Tie Route to selected state
       *
       * When the route changed look for the selected
       * attribute and update the internal selected state
       */
      __routeChanged: function (route) {
        const params = route.__queryParams;
        const selected = params.demo || null;
        if (selected) {
          this.selected = selected;
        }
      },


    });
  </script>
</dom-module>
